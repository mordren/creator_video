{% extends "base.html" %}

{% block title %}Vídeo: - Sistema de Vídeos{% endblock %}

{% block content %}

<!-- templates/video.html -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
            {% if edit_mode %}
                Editando Vídeo
            {% else %}
                Detalhes do Vídeo
            {% endif %}
        </h5>
        <div>
            <!-- BOTÃO EDITAR - SEMPRE VISÍVEL NO MODO DE VISUALIZAÇÃO -->
            {% if not edit_mode %}
            <a href="{{ url_for('video_detail', roteiro_id=video.roteiro_id) }}?edit=1" 
               class="btn btn-primary me-2">
                <i class="fas fa-edit"></i> Editar
            </a>
            {% endif %}
            
            <a href="{{ url_for('videos') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
            
            <!-- BOTÕES DE AÇÃO NO MODO EDIÇÃO -->
            {% if edit_mode %}
            <div class="btn-group ms-2">
                <button type="submit" form="edit-form" class="btn btn-success">
                    <i class="fas fa-save"></i> Salvar
                </button>
                <a href="{{ url_for('video_detail', roteiro_id=video.roteiro_id) }}" 
                   class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="card-body">
        <form id="edit-form" method="POST" action="{{ url_for('video_detail', roteiro_id=video.roteiro_id) }}">
            <div class="row">
                <!-- Coluna 1: Informações Básicas do Roteiro -->
                <div class="col-md-6">
                    <h6 class="mb-3 text-primary"><strong>Informações do Roteiro</strong></h6>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Roteiro ID</strong></label>
                        <p class="form-control-plaintext">{{ video.roteiro_id }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Título</strong></label>
                        {% if edit_mode %}
                        <input type="text" class="form-control" name="titulo" 
                               value="{{ video.roteiro.titulo }}" required>
                        {% else %}
                        <p class="form-control-plaintext">{{ video.roteiro.titulo }}</p>
                        {% endif %}
                    </div>

                    <!-- TEXTAREA GRANDE PARA O TEXTO COMPLETO DO ROTEIRO -->
                    <div class="mb-3">
                        <label class="form-label"><strong>Texto do Roteiro</strong></label>
                        {% if edit_mode %}
                        <textarea class="form-control" name="texto" rows="15" 
                                  placeholder="Digite o texto completo do roteiro aqui...">{{ video.roteiro.texto }}</textarea>
                        <small class="text-muted">Use este campo para editar todo o conteúdo do roteiro</small>
                        {% else %}
                        <div class="form-control-plaintext" style="max-height: 400px; overflow-y: auto; white-space: pre-wrap; background-color: #f8f9fa; padding: 12px; border-radius: 4px;">
                            {{ video.roteiro.texto }}
                        </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Descrição</strong></label>
                        {% if edit_mode %}
                        <textarea class="form-control" name="descricao" rows="3">{{ video.roteiro.descricao }}</textarea>
                        {% else %}
                        <p class="form-control-plaintext">{{ video.roteiro.descricao }}</p>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Tags</strong></label>
                        {% if edit_mode %}
                        <input type="text" class="form-control" name="tags" 
                               value="{{ video.roteiro.tags }}" placeholder="tag1, tag2, tag3">
                        {% else %}
                        <p class="form-control-plaintext">{{ video.roteiro.tags }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Coluna 2: Status e Configurações -->
                <div class="col-md-6">
                    <h6 class="mb-3 text-primary"><strong>Configurações do Vídeo</strong></h6>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Status Upload</strong></label>
                        {% if edit_mode %}
                        <select class="form-select" name="status_upload">
                            <option value="rascunho" {{ 'selected' if video.status_upload == 'rascunho' }}>Rascunho</option>
                            <option value="enviando" {{ 'selected' if video.status_upload == 'enviando' }}>Enviando</option>
                            <option value="publicado" {{ 'selected' if video.status_upload == 'publicado' }}>Publicado</option>
                            <option value="erro" {{ 'selected' if video.status_upload == 'erro' }}>Erro</option>
                        </select>
                        {% else %}
                        <p>
                            {% if video.status_upload == 'rascunho' %}
                                <span class="badge bg-warning">Rascunho</span>
                            {% elif video.status_upload == 'enviando' %}
                                <span class="badge bg-info">Enviando</span>
                            {% elif video.status_upload == 'publicado' %}
                                <span class="badge bg-success">Publicado</span>
                            {% else %}
                                <span class="badge bg-danger">{{ video.status_upload }}</span>
                            {% endif %}
                        </p>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>ID do Vídeo</strong></label>
                        {% if edit_mode %}
                        <input type="text" class="form-control" name="id_video" 
                               value="{{ video.roteiro.id_video }}">
                        {% else %}
                        <p class="form-control-plaintext">{{ video.roteiro.id_video }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Data Criação</strong></label>
                        <p class="form-control-plaintext">{{ video.data_criacao.strftime('%d/%m/%Y %H:%M') }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>TTS Provider</strong></label>
                        {% if edit_mode %}
                        <input type="text" class="form-control" name="tts_provider" 
                               value="{{ video.tts_provider }}">
                        {% else %}
                        <p class="form-control-plaintext">{{ video.tts_provider }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label"><strong>Voz TTS</strong></label>
                        {% if edit_mode %}
                        <input type="text" class="form-control" name="voz_tts" 
                               value="{{ video.voz_tts }}">
                        {% else %}
                        <p class="form-control-plaintext">{{ video.voz_tts }}</p>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Duração</strong></label>
                        {% if edit_mode %}
                        <input type="number" class="form-control" name="duracao" 
                               value="{{ video.duracao }}">
                        {% else %}
                        <p class="form-control-plaintext">{{ video.duracao }} segundos</p>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><strong>Visualizações</strong></label>
                        {% if edit_mode %}
                        <input type="number" class="form-control" name="visualizacao_total" 
                               value="{{ video.visualizacao_total }}">
                        {% else %}
                        <p class="form-control-plaintext">{{ video.visualizacao_total }}</p>
                        {% endif %}
                    </div>

                    <!-- Campos Booleanos do Roteiro -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label"><strong>Áudio Gerado</strong></label>
                                {% if edit_mode %}
                                <select class="form-select" name="audio_gerado">
                                    <option value="true" {{ 'selected' if video.roteiro.audio_gerado }}>Sim</option>
                                    <option value="false" {{ 'selected' if not video.roteiro.audio_gerado }}>Não</option>
                                </select>
                                {% else %}
                                <span class="badge bg-{{ 'success' if video.roteiro.audio_gerado else 'secondary' }}">
                                    {{ 'Sim' if video.roteiro.audio_gerado else 'Não' }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label"><strong>Vídeo Gerado</strong></label>
                                {% if edit_mode %}
                                <select class="form-select" name="video_gerado">
                                    <option value="true" {{ 'selected' if video.roteiro.video_gerado }}>Sim</option>
                                    <option value="false" {{ 'selected' if not video.roteiro.video_gerado }}>Não</option>
                                </select>
                                {% else %}
                                <span class="badge bg-{{ 'success' if video.roteiro.video_gerado else 'secondary' }}">
                                    {{ 'Sim' if video.roteiro.video_gerado else 'Não' }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label"><strong>Finalizado</strong></label>
                                {% if edit_mode %}
                                <select class="form-select" name="finalizado">
                                    <option value="true" {{ 'selected' if video.roteiro.finalizado }}>Sim</option>
                                    <option value="false" {{ 'selected' if not video.roteiro.finalizado }}>Não</option>
                                </select>
                                {% else %}
                                <span class="badge bg-{{ 'success' if video.roteiro.finalizado else 'secondary' }}">
                                    {{ 'Sim' if video.roteiro.finalizado else 'Não' }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <!-- Arquivos -->
            <h6 class="mb-3"><strong>Arquivos:</strong></h6>
            <div class="row">
                <div class="col-md-6 mb-2">
                    <label class="form-label"><small>Áudio:</small></label>
                    {% if edit_mode %}
                    <input type="text" class="form-control" name="arquivo_audio" 
                           value="{{ video.arquivo_audio }}">
                    {% else %}
                    <p class="form-control-plaintext text-truncate"><small>{{ video.arquivo_audio }}</small></p>
                    {% endif %}
                </div>
                
                <div class="col-md-6 mb-2">
                    <label class="form-label"><small>Vídeo:</small></label>
                    {% if edit_mode %}
                    <input type="text" class="form-control" name="arquivo_video" 
                           value="{{ video.arquivo_video }}">
                    {% else %}
                    <p class="form-control-plaintext text-truncate"><small>{{ video.arquivo_video }}</small></p>
                    {% endif %}
                </div>
                
                <div class="col-md-6 mb-2">
                    <label class="form-label"><small>Legenda:</small></label>
                    {% if edit_mode %}
                    <input type="text" class="form-control" name="arquivo_legenda" 
                           value="{{ video.arquivo_legenda }}">
                    {% else %}
                    <p class="form-control-plaintext text-truncate"><small>{{ video.arquivo_legenda }}</small></p>
                    {% endif %}
                </div>
                
                <div class="col-md-6 mb-2">
                    <label class="form-label"><small>Áudio Mixado:</small></label>
                    {% if edit_mode %}
                    <input type="text" class="form-control" name="audio_mixado" 
                           value="{{ video.audio_mixado }}">
                    {% else %}
                    <p class="form-control-plaintext text-truncate"><small>{{ video.audio_mixado }}</small></p>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
</div>

<style>
.text-truncate {
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.form-control-plaintext {
    background-color: #f8f9fa;
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid #e9ecef;
}
/* Estilo para a área de texto grande */
textarea.form-control {
    min-height: 300px;
    resize: vertical;
}
</style>


{% endblock %}